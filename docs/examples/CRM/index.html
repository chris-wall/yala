<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>YALA Examples - Simple CRM</title>

  <style>
    html, body {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-size: 14px;
    }

    body {
      box-sizing: border-box;
      display: flex;
      flex-flow: column nowrap;
      justify-content: flex-start;
      align-content: stretch;
      align-items: stretch;

      background-color: #fff;
      color: #1a1a1a;
    }

    body > header {
      height: 4em;
      width: 100%;
      display: flex;
      flex-flow: row nowrap;
      justify-content: space-between;
      align-content: center;
      align-items: center;

      background-color: #000;
      color: #fff;
    }

    body > header > span.title {
      font-size: 2em;
      font-weight: bold;
    }

    body > header > nav {
      display: flex;
      flex-flow: row nowrap;
      justify-content: flex-start;
      align-content: center;
      align-items: center;
    }

    body > header > nav > a {
      height: 100%;
      line-height: 100%;
      display: flex;
      justify-content: center;
      align-content: center;
      border-bottom: solid 2px transparent;

      background-color: transparent;
      transition: background-color .33s ease;
      transition: border-bottom-color .5s ease;
    }

    body > header > nav > a:hover {
      background-color: #5a5a5a;
    }

    body > header > nav > a.active {
      border-bottom-color: #ff5a5a;
    }

    body > main {
      overflow: hidden;
    }

    body > main > aside {
      overflow-y: auto;
      overflow-x: hidden;
    }

    body > main > article {
      overflow-y: auto;
      overflow-x: hidden;
    }
  </style>
</head>
<body>
  <header>
    <span class="title">YALA CRM</span>
    <nav id="area-nav"></nav>
  </header>
  <main>
    <aside class="nav">
      <nav id="resource-nav"></nav>
    </aside>
    <article id="yala"></article>
  </main>
  <script src="../../../dist/umd/yala.js"></script>
  <script>  
  (() => {

    function startApp() {

      function resourceHelper(config, key, options) {
        const defaults = {
          keyField: 'key',
          nameField: 'name',
          displayName: `${key.charAt(0).toUpperCase()}${key.slice(1).toLowerCase()}`,
          pluralName: `${singularName}s`,
        };

        return config.addResource(key, Object.assign({}, defaults, options))
          .addField('key', { 
            isReadonly: true,
            isKey: true 
          })
          .addField('created', {
            type: 'datetime',
            isReadonly: true,
            isAutoGenerated: true,
            generator: obj => Object.assign({}, obj, { created: new Date() })
          });
      }

      const conf = yala.configure({
        includeRootArea: false,
        dashboardRedirect: 'customers',
      });
      
      const $addr = resourceHelper(conf, 'address', { pluralName: 'Addresses', embedOnly: true })
        .addField('street1')
        .addField('street2')
        .addField('city')
        .addField('state')
        .addField('zipCode');

      const $contact = resourceHelper(conf, 'contact', { nameField: 'fullName' })
        .addField('fullName', {
          isComputed: true,
          generator: object => `${object.firstName} ${object.lastName}`
        })
        .addField('firstName')
        .addField('lastName')
        .addField('organizationId', {
          type: 'relation',
          relatedTo: 'business'
        })
        .addField('phone', {
          format: 'tel'
        })
        .addField('email', {
          format: 'email'
        })
        .addField('Address', {
          type: 'embedded',
          relatedTo: 'address'
        });

      const $org = resourceHelper(conf, 'business', { nameField: 'legalName', displayName: 'Organization' })
        .addField('legalName')
        .addField('primaryContact', {
          type: 'relation',
          relatedTo: 'contact'
        })
        .addField('Address', {
          type: 'embedded',
          relatedTo: 'address'
        })
        .addField('industryId',  {
          type: 'relation',
          relatedTo: 'industry'
        });

      const $campaign = resourceHelper(conf, 'campaign')
        .addField('name')
        .addField('target', {
          type: 'enum',
          relatedTo: 'campaign-target'
        });

      const $message = resourceHelper(conf, 'message')
        .addField('name')
        .addField('body')
        .addField('campaignId', {
          type: 'relation',
          relatedTo: 'campaign'
        });
      

      const $industry = resourceHelper(conf, 'industry', { pluralName: 'Industries' })
        .addField('name');
      
      conf.addEnum('campaign-target', { 
        values : { primaryOnly: 'Primary Only', all: 'All Contacts' } 
      });

      const $customerArea = conf.addArea('customers', {
        dashboardRedirect: 'contact'
      }).includeResources('contact', 'business');

      const $marketingArea = conf.addArea('marketing', {
        dashboardRedirect: 'campaign'
      }).includeResources('campaign', 'industry');

      const app = yala.app('yala-crm', conf);
      app.attach('yala', 'appContent');
      app.attach('area-nav', 'appNav-Areas');
      app.attach('resource-nav', 'appNav-ActiveArea');
      app.run();
    }

    if (document.readyState!='loading') {
      startApp();
    }
    else if (document.addEventListener) {
      document.addEventListener('DOMContentLoaded', (evt) => startApp());
    } 
    else {
      console.error('YALA requires a modern browser.');
    }
  })();
  </script>
</body>
</html>